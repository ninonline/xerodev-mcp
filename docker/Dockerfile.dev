# Development Dockerfile with hot-reload
# Use: docker compose up (default uses this file)

FROM node:20-alpine

# Install build dependencies for better-sqlite3 native module
RUN apk add --no-cache python3 make g++ sqlite-dev

WORKDIR /app

# Copy package files first for better caching
COPY package*.json ./

# Install all dependencies (including devDependencies for tsx)
# Skip prepare script since we use tsx for development (no build needed)
RUN npm ci --ignore-scripts

# Copy source code (will be overridden by volume mount in docker-compose)
COPY . .

# Create data directory for SQLite
RUN mkdir -p /app/data

# Environment defaults
ENV NODE_ENV=development
ENV MCP_MODE=mock
ENV MCP_DATA_DIR=/app/data

# Expose port (if needed for future HTTP transport)
EXPOSE 3000

# Run with hot-reload using tsx watch
CMD ["npm", "run", "dev"]
